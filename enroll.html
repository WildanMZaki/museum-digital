<!doctype html>
<html lang="id">
  <head>
    <meta charset="utf-8">
    <title>Enroll â€” Museum Digital Sejarah Islam</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap & Fonts -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet">
    <link
      href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Poppins:wght@400;600&display=swap"
      rel="stylesheet">

    <style>
      /* === GLOBAL === */
      body {
        margin: 0;
        font-family: 'Poppins', sans-serif;
        color: #3b2a20;
        min-height: 100vh;
        overflow-x: hidden;
        background-color: #f5e8dc;
        background-image: url('./assets/img/landing.jpg');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        backdrop-filter: blur(8px) brightness(0.95);
        transition: all 0.8s ease;
      }
      body::before {
        content: "";
        position: absolute;
        inset: 0;
        background: rgba(240, 225, 210, 0.7);
        backdrop-filter: blur(6px);
        z-index: 0;
      }
      main, nav, .container { position: relative; z-index: 1; }

      /* === NAVBAR === */
      .navbar {
        background: rgba(233, 213, 192, 0.9);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(180, 150, 120, 0.3);
        position: fixed; top: 0; width: 100%; z-index: 10;
      }
      .navbar-brand { color: #8b5e3c !important; font-weight: 600; font-family: 'Merriweather', serif; }

      /* === HERO === */
      .hero-section { padding-top: 8rem; padding-bottom: 3rem; text-align: center; animation: fadeInUp 1.2s ease; }
      .hero-section h1 { font-family: 'Merriweather', serif; font-size: 2rem; color: #8b5e3c; margin-bottom: 0.5rem; }
      .hero-section p { color: #6e4b2f; font-size: 1rem; }

      /* === CARD === */
      .museum-card {
        background: #f1dfcf;
        border: 1px solid rgba(160, 107, 69, 0.2);
        border-radius: 20px;
        box-shadow: 0 0 20px rgba(160, 107, 69, 0.15);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .museum-card:hover { transform: translateY(-5px); box-shadow: 0 0 25px rgba(160, 107, 69, 0.25); }
      .museum-input { background-color: #f8ecde; color: #3b2a20; border: none; }
      .museum-input:focus { border: 1px solid #a06b45; box-shadow: 0 0 8px rgba(160, 107, 69, 0.4); }
      .museum-cta { background-color: #a06b45; border: none; color: #fffaf2; font-weight: 600; transition: all 0.3s ease; }
      .museum-cta:hover { background-color: #8b5e3c; transform: scale(1.05); }

      /* === TIKET === */
      .museum-ticket { background: linear-gradient(145deg, #f1dfcf, #e4c9b1); color: #3b2a20; padding: 1rem; border-radius: 12px; box-shadow: 0 0 25px rgba(139, 94, 60, 0.25); font-family: 'Merriweather', serif; animation: fadeIn 0.6s ease; }
      .museum-ticket-header { display: flex; justify-content: space-between; border-bottom: 1px solid rgba(60, 40, 20, 0.2); margin-bottom: .5rem; }
      .museum-ticket-title { font-weight: bold; color: #8b5e3c; }
      .museum-ticket-code { font-family: monospace; background: rgba(0, 0, 0, 0.05); padding: 2px 6px; border-radius: 5px; }
      .btn-start { background-color: #8b5e3c; border: none; color: #fffaf2; font-weight: 600; transition: all 0.3s ease; }
      .btn-start:hover { background-color: #6e4b2f; transform: scale(1.05); }

      /* === ANIMASI === */
      @keyframes fadeInUp { from { opacity: 0; transform: translateY(25px); } to { opacity: 1; transform: translateY(0); } }
      @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
  </head>

  <body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg shadow-sm">
      <div class="container">
        <a class="navbar-brand" href="#">ðŸ•Œ Museum Digital</a>
      </div>
    </nav>

    <!-- MAIN -->
    <main class="container hero-section">
      <h1>Ambil Tiket Belajar</h1>
      <p>Masukkan nama dan nama sekolahmu.<br> Tiket ini hanya disimpan di
        perangkat kamu ðŸ•Œ</p>

      <div class="row justify-content-center mt-4">
        <div class="col-md-7">
          <div class="card museum-card shadow-sm">
            <div class="card-body">

              <!-- FORM PENDAFTARAN -->
              <form id="enrollForm" class="row g-3">
                <div class="col-12">
                  <label class="form-label">Nama</label>
                  <input required type="text" class="form-control museum-input"
                    id="name" autocomplete="off">
                </div>
                <div class="col-12">
                  <label class="form-label">Nama Sekolah</label>
                  <input required type="text" class="form-control museum-input"
                    id="school" autocomplete="off">
                </div>
                <div class="col-12 d-grid">
                  <button class="btn museum-cta">Ambil Tiket</button>
                </div>
              </form>

              <!-- TAMPILAN TIKET -->
              <div id="ticketBox" class="museum-ticket-box d-none mt-4">
                <div class="museum-ticket">
                  <div class="museum-ticket-header">
                    <span class="museum-ticket-title">Museum Digital Pass</span>
                    <span class="museum-ticket-date" id="tDate"></span>
                  </div>
                  <div class="museum-ticket-info">
                    <div><strong>Nama:</strong> <span id="tName"></span></div>
                    <div><strong>Sekolah:</strong> <span
                        id="tSchool"></span></div>
                    <div><strong>Kode:</strong> <span class="museum-ticket-code"
                        id="tCode"></span></div>
                  </div>
                  <div class="d-grid mt-3">
                    <a class="btn btn-start btn-sm" id="startBtn"
                      href="map.html">Mulai Jelajah</a>
                  </div>
                </div>
              </div>

            </div> <!-- card-body -->
          </div>
        </div>
      </div>
    </main>

    <!-- Store helper (agar window.store tersedia jika ada) -->
    <script src="assets/js/app.js"></script>
    <script>
      (function(){
        const form    = document.getElementById('enrollForm');
        const box     = document.getElementById('ticketBox');
        const tName   = document.getElementById('tName');
        const tSchool = document.getElementById('tSchool');
        const tCode   = document.getElementById('tCode');
        const tDate   = document.getElementById('tDate');
        const startBtn= document.getElementById('startBtn');

        // safe store wrapper (pakai window.store kalau ada, fallback localStorage)
        const Store = {
          get(key){
            try{
              if (window.store?.get) return window.store.get(key);
              const raw = localStorage.getItem(key);
              return raw ? JSON.parse(raw) : null;
            }catch{ return null; }
          },
          set(key, val){
            try{
              if (window.store?.set) return window.store.set(key, val);
              localStorage.setItem(key, JSON.stringify(val));
            }catch{}
          }
        };

        function dateStr(ts){
          try{
            const d = ts ? new Date(ts) : new Date();
            return d.toLocaleDateString('id-ID', { day:'2-digit', month:'long', year:'numeric' });
          }catch{ return ''; }
        }

        function renderTicket(ticket){
          if(!ticket){ // tidak ada ticket
            box.classList.add('d-none');
            form.classList.remove('d-none');
            return;
          }
          tName.textContent   = ticket.name || '';
          tSchool.textContent = ticket.school || '';
          tCode.textContent   = ticket.code || '';
          tDate.textContent   = dateStr(ticket.ts);

          // sembunyikan form, tampilkan tiket
          form.classList.add('d-none');
          box.classList.remove('d-none');

          // optional: handle redirect param (jika suatu saat dipakai)
          try{
            const redirect = new URLSearchParams(location.search).get('redirect');
            if (redirect === 'map') startBtn.href = 'map.html';
            // biarkan default ke map.html jika redirect lain tidak valid
          }catch{}
        }

        function readTicket(){
          return Store.get('ticket');
        }

        function writeTicket({name, school}){
          const code = 'MD-' + Math.random().toString(36).substring(2,8).toUpperCase();
          const payload = { name, school, code, ts: Date.now() };
          Store.set('ticket', payload);
          return payload;
        }

        // on submit: simpan + render
        form.addEventListener('submit', function(e){
          e.preventDefault();
          const name = document.getElementById('name').value.trim();
          const school = document.getElementById('school').value.trim();
          if(!name || !school) return;

          const ticket = writeTicket({ name, school });
          renderTicket(ticket);
          box.scrollIntoView({ behavior: 'smooth' });
        });

        // initial render (jika sudah punya tiket sebelumnya)
        renderTicket(readTicket());
      })();
    </script>
  </body>
</html>
